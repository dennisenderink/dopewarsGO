"use strict";function updateStats(){$("[js-day-curr]").html(player.dayCurr),$("[js-day-max]").html(player.dayMax),$("[js-cash]").find("span").html(player.cash),$("[js-inv-curr]").html(player.invCurr),$("[js-inv-max]").html(player.invMax)}function restartButtons(){$("[js-game-restart]").on("tap",function(){console.log("dead"),window.location.reload(!0)})}function modalButtons(){$(".c-modal__close, [js-modal-close]").on("tap",function(){$(this).closest(".c-modal").fadeOut(200,function(){$(this).remove()})})}function removeSlide(e){e.removeClass("c-slide--active").addClass("c-slide--remove")}function Dope(e,t,a,o){this.name=e,this.priceMin=t,this.priceMax=a,this.amount=o,this.priceCurr=function(e){e<1?(t/=2,a/=2):1===e?(t=t,a=a):e>1&&(a+=t=a-t);var o=Math.random();return this.random=o,Math.floor((a-t+1)*o+t)},dopelist.push(this)}function setRandomPrices(){dopelist.forEach(function(e){updateDopePrice(e,1)})}function updateDopePrice(e,t){var a=e.priceCurr(t),o=e.random,n=$('[data-js-dope="'+e.name+'"]').find("[js-dope-price]");n.html(a);var s="rgb(255,255,255)";if(o>.5){var r=Math.floor(255-255*(o-.5));s="rgb(255,"+r+","+r+")"}else{var i=Math.floor(255-255*(.5-o));s="rgb("+i+",255,"+i+")"}n.css("color",s),updateButtons()}function updateButtons(){dopelist.forEach(function(e){var t=$('[data-js-dope="'+e.name+'"]'),a=parseInt(t.find("[js-dope-amount]").html()),o=t.find("[js-dope-sell]").find(".button--trade");a<=0?o.addClass("button--disabled"):o.removeClass("button--disabled");var n=parseInt(t.find("[js-dope-price]").html()),s=t.find("[js-dope-buy]").find(".button--trade");n>player.cash?s.addClass("button--disabled"):s.removeClass("button--disabled");var r=$("[js-inv-curr]").html();$("[js-inv-max]").html()-r<=0&&s.addClass("button--disabled")})}function buttonTrade(e,t){if(!e.hasClass("button--disabled")){var a,o=e.closest("tr"),n=o.attr("data-js-dope"),s=parseInt(o.find("[js-dope-price]").html());a="tap"===t?e.hasClass("button--buy")?1:-1:e.hasClass("button--buy")?Math.floor(player.cash/s):-1*o.find("[js-dope-amount]").html();var r=player.invCurr,i=player.invMax-r;a>i&&(a=i),player.cash-=s*a,updateStats(),updateDopeAmount(n,a)}}function updateDopeAmount(e,t){for(var a in dopelist)dopelist[a].name==e&&(dopelist[a].amount+=t,$('[data-js-dope="'+e+'"]').find("[js-dope-amount]").html(dopelist[a].amount));player.invCurr+=t,updateStats(),updateButtons()}function updateDay(){parseInt($("[js-day-curr]").html())==parseInt($("[js-day-max]").html())?(dopelist.forEach(function(e){var t=$('[data-js-dope="'+e.name+'"]'),a=parseInt(t.find("[js-dope-amount]").html());if(a>0){var o=parseInt(t.find("[js-dope-price]").html())*a;updateCash(o),updateDopeAmount(t,a),updateButtons()}}),removeSlide($(this).closest(".c-slide")),alert("Your final score is: "+$("[js-cash]").find("span").html()),window.location.reload(!0)):($("[js-day-curr]").html(parseInt($("[js-day-curr]").html())+1),setRandomPrices(),randomEvents())}function getLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(showPosition,showError):x.innerHTML="Geolocation is not supported by this browser."}function showPosition(e){x.innerHTML="Latitude: "+e.coords.latitude+"<br />Longitude: "+e.coords.longitude}function showError(e){switch(e.code){case e.PERMISSION_DENIED:x.innerHTML="User denied the request for Geolocation.";break;case e.POSITION_UNAVAILABLE:x.innerHTML="Location information is unavailable.";break;case e.TIMEOUT:x.innerHTML="The request to get user location timed out.";break;case e.UNKNOWN_ERROR:x.innerHTML="An unknown error occurred."}}function initScreen(){screenHeight=$(".c-slide--active").height(),$(".s-site").height(screenHeight)}function createModal(e){$("body").append('        <div class="c-modal">            <div class="c-modal__content">                '+e+"            </div>        </div>    ").fadeIn(200),modalButtons()}function Event(e,t){this.name=e,this.chance=t,eventList.push(this)}function getEventChange(e,t){return e.chance*(100/t)}function getRandomEvent(e){for(var t=0;t<e.length;t++)if(e[t].chance>=100*eventRNG)return eventRNG=Math.random(),e[t]}function randomEvents(){Math.random()>=0&&randomChanceFire()}function dopeArray(e){this.name=e}function randomChanceFire(){var e=getRandomEvent(eventMap);window[e.name]()}function oldLady(){alert("oldLady")}function dopeHigh(){var e=randomDope(dopelist),t=Math.random();createModal("        <h2>Drug Bust!</h2>        <p>"+(t>.33?"Addicts are buying "+e.name+" for ridiculous prices!":t>.66?"Cops made a big "+e.name+" bust! Prices are outrageous!":"The police raided a big "+e.name+" warehouse, prices have skyrocketed!")+'</p>        <div class="button" js-modal-close>Alright</div>    '),updateDopePrice(e,5)}function dopeLow(){var e=randomDope(dopelist);createModal("        <h2>Market flooded!</h2>        <p>"+("Hashish"===e?"The Marrakesh Express has arrived!":"Rival gangs raided some pharmacies and cheap "+e.name+" has flooded the market")+'</p>        <div class="button" js-modal-close>Cool</div>    '),updateDopePrice(e,.1)}function findCoat(){alert("findCoat")}function findGun(){if(player.cash>=100)e='            <h2>Carrying</h2>            <p>Do you want to buy a gun for $100?</p>            <div class="c-button-group c-gun__controls">                <div class="button button--inline" js-gun-buy>Yeah!</div>                <div class="button button--inline" js-modal-close>Nah</div>            </div>        ';else var e='            <h2>Low on cash</h2>            <p>Someone offers to sell you a bigger gun for $100 but you are broke!</p>            <div class="c-gun__controls">                <div class="button" js-modal-close>Bummer!</div>            </div>        ';createModal(e),$("[js-gun-buy]").on("tap",function(){player.cash-=100,player.invCurr+=5,player.gun+=1,updateStats(),$(this).closest(".c-modal").fadeOut(200,function(){$(this).remove()})})}function pennyFound(){var e=Math.floor(100*Math.random())+1,t=Math.random();createModal("        <h2>Free monies!</h2>        <p>"+(t>.33?"Someone left some cash in an alley, you find $"+e+".":t>.66?"Your auntie May died and she left you $"+e+" inheritance.":"The cashier made a mistake on your change, you keep $"+e+" extra.")+'</p>        <div class="button" js-modal-close>Rad!</div>    '),updateCash(e)}function dopeFound(){var e,t=randomDope(dopelist).name,a=Math.floor(5*Math.random())+1,o=Math.random();e=o>.33?"You find "+a+" "+t+" on the subway.":o>.66?"An old friend drops by and he gives you "+a+" "+t+".":"In the back of your pocket you find "+a+" "+t+"!","Cocaine"!=t&&"Heroin"!=t&&(createModal("            <h2>Free Dope!</h2>            <p>"+e+'</p>            <div class="button" js-modal-close>Score!</div>        '),updateDopeAmount(t,a))}function officerHardass(){var e={health:100,loot:50,damage:10,winChance:50,escapeChance:30,biteChance:70,dropChance:50,bribeCost:500},t=Object.create(e);createModal('        <h2>The pigs!</h2>        <p>Officer Hardass and his deputies are chasing you! what do you do?</p>        <div class="s-row c-combat">            <div class="s-row__column s-row__column--half">                Hardass: <div class="c-health c-health--enemy"><span>'+t.health+'</span></div>            </div>            <div class="s-row__column s-row__column--half">                You: <div class="c-health c-health--player"><span>'+player.health+'</span></div>            </div>        </div>        <div class="c-button-group c-combat__controls">            <div class="button button--inline" js-combat-run>Run</div>            <div class="button button--inline" js-combat-fight>Fight</div>            <div class="button button--inline" js-combat-bribe>Bribe</div>        </div>        <p class="c-combat__result"></p>    '),$(".c-health--player span").html(player.health).css("width",player.health+"%"),$("[js-combat-bribe]").on("tap",function(){var e,a=Math.ceil(t.bribeCost*Math.random())+t.bribeCost;player.cash<a?(e="Maybe you should save some cash first, dipshit...",$("[js-combat-bribe]").hide()):e="Ill see it through the fingers this time. But its gonna cost ya $"+a+".",$(".c-combat__result").html(e),$("[js-combat-bribe]").html("pay").on("tap",function(){player.cash-=a,updateStats(),$(this).closest(".c-modal").fadeOut(200,function(){$(this).remove()})})}),$("[js-combat-run]").on("tap",function(){var e;if(t.escapeChance>=100*Math.random())e="You got away!",$(".c-combat__result").after('<div class="button" js-modal-close>Too close</div>'),modalButtons();else{var a=Math.ceil(4*Math.random());if(t.biteChance>=100*Math.random()){var o=Math.ceil(t.damage*Math.random())+2;e="Police dogs chase your for "+a+" blocks, you were bit for "+o+" damage!",player.health-=o,$(".c-health--player span").html(player.health).css("width",player.health+"%")}else e="Police dogs chase your for "+a+" blocks"}$(".c-combat__result").html(e)}),$("[js-combat-fight]").on("tap",function(){var e;if(t.winChance>=100*Math.random()){e="You shot officer Hardass!";var a=Math.ceil(player.damage*Math.random())*(player.gun+1)+player.damage;if(t.health-=a,t.health<=0){t.health=0,$(".c-combat__controls").hide();var o=Math.ceil(t.loot*Math.random())+t.loot;e="Officer Hardass drops dead!<br />On his body you find $"+o+".",player.cash+=o,updateStats(),$(".c-combat__result").after('<div class="button" js-modal-close>Later Hardass</div>'),modalButtons()}$(".c-health--enemy span").html(t.health).css("width",t.health+"%")}else{e="Officer Hardass takes a shot at you...";var n=Math.ceil(t.damage*Math.random())+t.damage;player.health-=n,player.health<=0&&(player.health=0,$(".c-combat__controls").hide(),e="Officer Hardass shot you dead sucker!<br />Your final score is: "+$("[js-cash]").find("span").html(),$(".c-combat__result").after('<div class="button" js-game-restart>Ah man!</div>'),restartButtons()),$(".c-health--player span").html(player.health).css("width",player.health+"%")}$(".c-combat__result").html(e)})}var PlayerConstruct={health:100,cash:2e3,invCurr:0,invMax:50,damage:20,gun:0,dayCurr:1,dayMax:7},player=Object.create(PlayerConstruct);updateStats(),$("[js-button-jet]").on("tap",function(){updateDay()}),$("[js-slide-button]").each(function(){$(this).on("click",function(){$(".c-slide").removeClass("c-slide--remove");var e=$(this).attr("js-slide-target");$("[js-slide__"+e+"]").addClass("c-slide--active"),$(this).closest(".c-slide").removeClass("c-slide--active").addClass("c-slide--remove"),initScreen()})}),$.fn.digits=function(){return this.each(function(){$(this).text($(this).text().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"))})};var dopelist=[],dope1=new Dope("Acid",1e3,4400,0),dope2=new Dope("Cocaine",15e3,29e3,0),dope3=new Dope("Hashish",480,1280,0),dope4=new Dope("Heroin",5500,13e3,0),dope5=new Dope("Ludes",11,60,0),dope6=new Dope("MDA",1500,4400,0),dope7=new Dope("Opium",540,1250,0),dope8=new Dope("PCP",1e3,2500,0),dope9=new Dope("Peyote",220,700,0),dope10=new Dope("Shrooms",630,1300,0),dope11=new Dope("Speed",90,250,0),dope12=new Dope("Weed",315,890,0);dopelist.forEach(function(e){$("[js-dope-table-content]").append('        <tr js-dope data-js-dope="'+e.name+'">            <td>'+e.name+"</td>            <td js-dope-amount>"+e.amount+'</td>            <td js-dope-sell><button class="button button--trade button--sell">-</button></td>            <td js-dope-price></td>            <td js-dope-buy><button class="button button--trade button--buy">+</button></td>        </tr>    ')}),setRandomPrices(),$.event.special.tap.tapholdThreshold=400,$(".button--trade").on("tap",function(){buttonTrade($(this),"tap")}).on("taphold",function(){buttonTrade($(this),"taphold")});var x=$(".geolocation"),screenHeight;$(window).load(function(){initScreen()}),function(e){e.fn.nodDoubleTapZoom=function(){e(this).bind("touchstart",function(t){var a=t.timeStamp,o=a-(e(this).data("lastTouch")||a),n=t.originalEvent.touches.length;e(this).data("lastTouch",a),!o||o>500||n>1||(t.preventDefault(),e(t.target).trigger("click"))})}}(jQuery),$(document).on("pagecreate",".s-site",function(){$("body").nodDoubleTapZoom()});var eventList=[],eventChance=0,eventRNG=Math.random(),event1=new Event("oldLady",0),event2=new Event("officerHardass",99910),event3=new Event("dopeLow",20),event4=new Event("dopeHigh",20),event5=new Event("dopeFound",20),event7=new Event("pennyFound",20),event6=new Event("findCoat",0),event6=new Event("findGun",10),eventTotal=0;eventList.forEach(function(e){eventTotal+=e.chance});var eventMap=[],range=0;eventList.forEach(function(e){range+=getEventChange(e,eventTotal),eventMap.push(new Event(e.name,range))});var dopeMap=[];dopelist.forEach(function(e){dopeMap.push(new dopeArray(e.name))});var randomDope=function(e){var t=Object.keys(e);return e[t[t.length*Math.random()<<0]]};