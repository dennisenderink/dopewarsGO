"use strict";function removeSlide(e){e.removeClass("c-slide--active").addClass("c-slide--remove")}function updateCash(e){var t=parseInt($("[js-cash]").find("span").html())+e;$("[js-cash]").find("span").html(t),cashCurr=parseInt($("[js-cash]").find("span").html())}function updateDope(e,t){}function Dope(e,t,n,o){this.name=e,this.priceMin=t,this.priceMax=n,this.amount=o,this.priceCurr=function(e){if(e<1)a=Math.random()*e;else if(1===e)a=Math.random();else if(e>1)var o=e-1,a=Math.random()/e+o/e;return this.random=a,Math.floor((n-t+1)*a+t)},dopelist.push(this)}function setRandomPrices(){dopelist.forEach(function(e){updateDopePrice(e,1)}),updateButtons()}function updateDopePrice(e,t){var n=e.priceCurr(t),o=e.random,a=$('[data-js-dope="'+e.name+'"]').find("[js-dope-price]");a.html(n);var s="rgb(255,255,255)";if(o>.5){var d=Math.floor(255-255*(o-.5));s="rgb(255,"+d+","+d+")"}else{var i=Math.floor(255-255*(.5-o));s="rgb("+i+",255,"+i+")"}a.css("color",s)}function updateButtons(){dopelist.forEach(function(e){var t=$('[data-js-dope="'+e.name+'"]'),n=parseInt(t.find("[js-dope-amount]").html()),o=t.find("[js-dope-sell]").find(".button--trade");n<=0?o.addClass("button--disabled"):o.removeClass("button--disabled");var a=parseInt(t.find("[js-dope-price]").html()),s=t.find("[js-dope-buy]").find(".button--trade");a>cashCurr?s.addClass("button--disabled"):s.removeClass("button--disabled");var d=$("[js-inv-curr]").html();$("[js-inv-max]").html()-d<=0&&s.addClass("button--disabled")})}function buttonTrade(e,t){if(!e.hasClass("button--disabled")){var n,o=e.closest("tr"),a=o.attr("data-js-dope"),s=parseInt(o.find("[js-dope-price]").html());n="tap"===t?e.hasClass("button--buy")?1:-1:e.hasClass("button--buy")?Math.floor(cashCurr/s):-1*o.find("[js-dope-amount]").html();var d=$("[js-inv-curr]").html(),i=$("[js-inv-max]").html()-d;n>i&&(n=i),updateCash(s*n*-1),updateDopeAmount(a,n)}}function updateDopeAmount(e,t){for(var n in dopelist)dopelist[n].name==e&&(dopelist[n].amount+=t,$('[data-js-dope="'+e+'"]').find("[js-dope-amount]").html(dopelist[n].amount));updateInv(t),updateButtons()}function updateInv(e){var t=parseInt($("[js-inv-curr]").html())+e;$("[js-inv-curr]").html(t)}function updateDay(){parseInt($("[js-day-curr]").html())==parseInt($("[js-day-max]").html())?(dopelist.forEach(function(e){var t=$('[data-js-dope="'+e.name+'"]'),n=parseInt(t.find("[js-dope-amount]").html());n>0&&(updateCash(parseInt(t.find("[js-dope-price]").html())*n),updateDopeAmount(t,n),updateButtons())}),removeSlide($(this).closest(".c-slide")),alert("Your final score is: "+$("[js-cash]").find("span").html()),window.location.reload(!0)):($("[js-day-curr]").html(parseInt($("[js-day-curr]").html())+1),setRandomPrices(),randomEvents())}function getLocation(){navigator.geolocation?navigator.geolocation.getCurrentPosition(showPosition,showError):x.innerHTML="Geolocation is not supported by this browser."}function showPosition(e){x.innerHTML="Latitude: "+e.coords.latitude+"<br />Longitude: "+e.coords.longitude}function showError(e){switch(e.code){case e.PERMISSION_DENIED:x.innerHTML="User denied the request for Geolocation.";break;case e.POSITION_UNAVAILABLE:x.innerHTML="Location information is unavailable.";break;case e.TIMEOUT:x.innerHTML="The request to get user location timed out.";break;case e.UNKNOWN_ERROR:x.innerHTML="An unknown error occurred."}}function initScreen(){screenHeight=$(".c-slide--active").height(),$(".s-site").height(screenHeight)}function modalButtons(){$(".c-modal__close, [js-modal-close]").on("click",function(){$(this).closest(".c-modal").fadeOut(200,function(){$(this).remove()})})}function createModal(e){$("body").append('        <div class="c-modal">            <div class="c-modal__content">                '+e+"            </div>        </div>    ").fadeIn(200),modalButtons()}function Event(e,t){this.name=e,this.chance=t,eventList.push(this)}function getEventChange(e,t){return e.chance*(100/t)}function getRandomEvent(e){for(var t=0;t<e.length;t++)if(e[t].chance>=100*eventRNG)return eventRNG=Math.random(),e[t]}function randomEvents(){Math.random()>=.5&&randomChanceFire()}function dopeArray(e){this.name=e}function randomChanceFire(){var e=getRandomEvent(eventMap);window[e.name]()}function oldLady(){alert("oldLady")}function officerHardass(){createModal('        <h2>Shit, the pigs!</h2>        <p>Officer Hardass and his deputies are chasing you!</p>        <div class="c-health--hardass">Hardass: <span>100</span></div>        <div class="c-health--you">You: <span>100</span></div>        <p>what do you do?</p>        <div class="button button--inline" js-hardass-run>Run</div>        <div class="button button--inline" js-hardass-fight>Fight</div>        <div class="button button--inline" js-hardass-bribe>Bribe</div>    ')}function dopeHigh(){var e=randomDope(dopelist);createModal("        <h2>Drug Bust!</h2>        <p>Cops made a big "+e.name+' bust, prices are outrageous!</p>        <div class="button" js-modal-close>Alright</div>    '),updateDopePrice(e,5)}function dopeLow(){var e=randomDope(dopelist);createModal("        <h2>Market flooded!</h2>        <p>Rival gangs raided some pharmacies and cheap "+e.name+' have flooded the market</p>        <div class="button" js-modal-close>Cool</div>    '),updateDopePrice(e,.1)}function findCoat(){alert("findCoat")}function pennyFound(){var e=Math.floor(100*Math.random())+1;createModal("        <h2>Free monies!</h2>        <p>Someone left some cash in an alley, you find $"+e+'.</p>        <div class="button" js-modal-close>Rad!</div>    '),updateCash(e)}function dopeFound(){var e=randomDope(dopelist).name;if("Cocaine"!=e&&"Heroin"!=e){var t=Math.floor(5*Math.random())+1;createModal("            <h2>Free Dope!</h2>            <p>You find "+t+" "+e+' on the subway.</p>            <div class="button" js-modal-close>Score!</div>        '),updateDopeAmount(e,t)}}$("[js-slide-button]").each(function(){$(this).on("click",function(){$(".c-slide").removeClass("c-slide--remove");var e=$(this).attr("js-slide-target");$("[js-slide__"+e+"]").addClass("c-slide--active"),$(this).closest(".c-slide").removeClass("c-slide--active").addClass("c-slide--remove"),initScreen()})}),$.fn.digits=function(){return this.each(function(){$(this).text($(this).text().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"))})};var cashStart=2e3,cashCurr=cashStart;updateCash(cashStart);var dopelist=[],dope1=new Dope("Acid",1e3,4400,0),dope2=new Dope("Cocaine",15e3,29e3,0),dope3=new Dope("Hashish",480,1280,0),dope4=new Dope("Heroin",5500,13e3,0),dope5=new Dope("Ludes",11,60,0),dope6=new Dope("MDA",1500,4400,0),dope7=new Dope("Opium",540,1250,0),dope8=new Dope("PCP",1e3,2500,0),dope9=new Dope("Peyote",220,700,0),dope10=new Dope("Shrooms",630,1300,0),dope11=new Dope("Speed",90,250,0),dope12=new Dope("Weed",315,890,0);dopelist.forEach(function(e){$("[js-dope-table-content]").append('        <tr js-dope data-js-dope="'+e.name+'">            <td>'+e.name+"</td>            <td js-dope-amount>"+e.amount+'</td>            <td js-dope-sell><button class="button button--trade button--sell">-</button></td>            <td js-dope-price></td>            <td js-dope-buy><button class="button button--trade button--buy">+</button></td>        </tr>    ')}),setRandomPrices(),$.event.special.tap.tapholdThreshold=400,$(".button--trade").on("tap",function(){buttonTrade($(this),"tap")}).on("taphold",function(){buttonTrade($(this),"taphold")}),$("[js-button-jet]").on("tap",function(){updateDay()});var x=$(".geolocation"),screenHeight;$(window).load(function(){initScreen()}),function(e){e.fn.nodDoubleTapZoom=function(){e(this).bind("touchstart",function(t){var n=t.timeStamp,o=n-(e(this).data("lastTouch")||n),a=t.originalEvent.touches.length;e(this).data("lastTouch",n),!o||o>500||a>1||(t.preventDefault(),e(t.target).trigger("click"))})}}(jQuery),$(document).on("pagecreate",".s-site",function(){$("body").nodDoubleTapZoom()});var eventList=[],eventChance=0,eventRNG=Math.random(),event1=new Event("oldLady",0),event2=new Event("officerHardass",0),event3=new Event("dopeLow",20),event4=new Event("dopeHigh",20),event5=new Event("dopeFound",20),event7=new Event("pennyFound",20),event6=new Event("findCoat",0),event6=new Event("findGun",0),eventTotal=0;eventList.forEach(function(e){eventTotal+=e.chance});var eventMap=[],range=0;eventList.forEach(function(e){range+=getEventChange(e,eventTotal),eventMap.push(new Event(e.name,range))});var dopeMap=[];dopelist.forEach(function(e){dopeMap.push(new dopeArray(e.name))});var randomDope=function(e){var t=Object.keys(e);return e[t[t.length*Math.random()<<0]]};